<!DOCTYPE html>
<html>
<head>
<title>Generate a random walk on Google Maps</title>
</head>
 
<body bgcolor="#ffffff" text="#000000" link="#ff0000" vlink="#800000" alink="#ff00ff" background="?">
<h3>My Google Maps Demo</h3>
<!--The div element for the map -->
<div id="map"></div>
<div id="directions-panel"></div>
<!-- Replace the value of the key parameter with your own API key. -->
<script type="text/javascript">
const apiKey = process.env.GOOGLE_MAPS_API_KEY;

// Create the script tag, set the appropriate attributes
var script = document.createElement('script');
script.src = 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&libraries=geometry&callback=initMap';
script.defer = true;
script.async = true;

// Append the 'script' element to 'head'
document.head.appendChild(script);

var directionsService;
var directionsRenderer;

// Initialize and add the map
window.initMap = function() 

  directionsService = new google.maps.DirectionsService;
  directionsRenderer = new google.maps.DirectionsRenderer;
  
  // home latitude/longitude
  // defaulting to O'Connell Street, Dublin
  var home = {lat: 53.3506006, lng: -6.2625474};
  // The map, centered at home
  var mapElement = document.getElementById('map');
  var map = new google.maps.Map(mapElement, {zoom: 13, center: home});
  directionsRenderer.setMap(map);
 
  // A circle, with 2km radius, centered at home
   var twoKmRadius = new google.maps.Circle({
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.05,
      map: map,
      center: home,
      radius: 2000
    });
  
  // Position a marker at home
  var marker = new google.maps.Marker({position: home, map: map});
  // Array of waypoints
  var waypoints = new Array();
  // Number of waypoints to add
  var markers = 5;
  
  var degreesInCircle = 360;
  var increase = degreesInCircle / markers;
  for (var bearing = 0; bearing < degreesInCircle; bearing += increase) {
 
    // Distance is a random number at most 2000m (2km) from home
    var distanceFromHome = Math.random() * 2000;
    // Calculate a point on the map, at a random distance from home
    // within the 2km radius
    var waypoint = google.maps.geometry.spherical.computeOffset(marker.getPosition(), distanceFromHome, bearing);
    // Push a new waypoint to the array
    waypoints.push({location: waypoint, stopover: true});
 
  }
 
  // Calculate a walkin route from home to home, 
  // with the waypoints created above
  directionsService.route({
    origin: marker.getPosition(),
    destination: marker.getPosition(),
    waypoints: waypoints,
    optimizeWaypoints: true,
    travelMode: 'WALKING',
    avoidHighways: true
  }, function(response, status) {
    if (status === 'OK') {
      directionsRenderer.setDirections(response);
      var route = response.routes[0];
      console.log(route);
      var summaryPanel = document.getElementById('directions-panel');
      summaryPanel.innerHTML = '';
      var distance = 0;
      // For each route, display summary information.
      for (var i = 0; i < route.legs.length; i++) {
        var routeSegment = i + 1;
        var leg = route.legs[i];
        summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
            '</b><br>';
        summaryPanel.innerHTML += leg.start_address + ' to ';
        summaryPanel.innerHTML += leg.end_address + '<br>';
        summaryPanel.innerHTML += leg.distance.text + '<br><br>';
        distance += leg.distance.value;
      }
      summaryPanel.innerHTML += distance + "m<br>";
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });
 
}
</script>
</body>
</html>
